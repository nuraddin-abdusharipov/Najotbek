<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Foydalanuvchi Paneli â€” Test Platforma</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="user-wrap">
      <header class="user-header">
        <div class="user-info">
          <h2><i class="fas fa-user"></i> Xush kelibsiz, <span id="username">...</span></h2>
          <p class="muted" id="userEmail"></p>
        </div>
        <button id="logout" class="btn ghost">
          <i class="fas fa-sign-out-alt"></i> Chiqish
        </button>
      </header>

      <div class="card">
        <h3><i class="fas fa-graduation-cap"></i> Test yo'nalishini tanlang</h3>
        <p class="muted">Quyidagi yo'nalishlardan birini tanlab testni boshlang</p>

        <div class="direction-info">
          <div class="info-card">
            <i class="fas fa-info-circle"></i>
            <div>
              <strong>15 ta savol</strong>
              <span>Har bir testda</span>
            </div>
          </div>
          <div class="info-card">
            <i class="fas fa-clock"></i>
            <div>
              <strong>30 daqiqa</strong>
              <span>Umumiy vaqt</span>
            </div>
          </div>
          <div class="info-card">
            <i class="fas fa-star"></i>
            <div>
              <strong>100 ball</strong>
              <span>Maksimal ball</span>
            </div>
          </div>
        </div>

        <div class="direction-selector">
          <div class="selector-label">
            <i class="fas fa-list"></i>
            Yo'nalishni tanlang:
          </div>
          <select id="directionSelect" class="direction-select">
            <option value="Boshlangich">Boshlang'ich matematika</option>
            <option value="Tenglama">Tenglama yechish</option>
            <option value="Grafik">Grafik analiz</option>
            <option value="Oddiy">Oddiy masalalar</option>
          </select>
        </div>

        <div class="action-buttons">
          <button id="startTest" class="btn primary start-btn">
            <i class="fas fa-play"></i>
            Testni boshlash
          </button>
        </div>
      </div>

      <!-- OXIRGI NATIJALAR QISMINI OLIB TASHLADIK -->

    </div>
  </div>

<script type="module">
import { auth, db } from './firebase.js';
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

// Foydalanuvchi holatini tekshirish
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    location.href = "login.html";
    return;
  }

  // Agar admin bo'lsa -> admin sahifasiga yo'naltir
  if (user.email === "admin@gmail.com") {
    location.href = "admin.html";
    return;
  }

  // Foydalanuvchi ma'lumotlarini chiqarish
  const userSnap = await getDocs(query(collection(db, "users"), where("uid", "==", user.uid)));
  if (!userSnap.empty) {
    const userData = userSnap.docs[0].data();
    document.getElementById("username").textContent = userData.username || "Foydalanuvchi";
  } else {
    document.getElementById("username").textContent = user.displayName || "Foydalanuvchi";
  }
  
  document.getElementById("userEmail").textContent = user.email;
});

// Testni boshlash
document.getElementById("startTest").addEventListener("click", () => {
  const selectedDirection = document.getElementById("directionSelect").value;
  localStorage.setItem('direction', selectedDirection);
  location.href = "test.html";
});

// Chiqish
document.getElementById("logout").addEventListener("click", () => {
  signOut(auth).then(() => location.href = "login.html");
});
</script>

<style>
.user-wrap {
  max-width: 600px;
  margin: 0 auto;
}

.user-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.direction-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin: 1.5rem 0;
}

.info-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 10px;
  border: 1px solid var(--card-border);
}

.info-card i {
  font-size: 1.5rem;
  color: var(--accent2);
}

.info-card div {
  display: flex;
  flex-direction: column;
}

.info-card strong {
  font-size: 1.1rem;
}

.info-card span {
  font-size: 0.8rem;
  color: var(--muted);
}

.direction-selector {
  margin: 2rem 0;
}

.selector-label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
  font-weight: 600;
}

.direction-select {
  width: 100%;
  margin-bottom: 1rem;
}

.action-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

.start-btn {
  flex: 1;
  font-size: 1.1rem;
  padding: 15px 25px;
}

@media (max-width: 768px) {
  .user-header {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
  
  .direction-info {
    grid-template-columns: 1fr;
  }
  
  .action-buttons {
    flex-direction: column;
  }
}
</style>
</body>
</html>
